---
slug: debug
---
{% assign href = "/how-platformos-works/about-platform-os" %}
{% assign path = "marketplace_builder/views/pages" | append: href %}
{% assign path = path | append: ".liquid" %}
{% assign data = '{ "path": "' | append: path | append: '"}' | to_hash %}

{% execute_query 'api_call', template: 'get_page_contributors_from_github', result_name: 'api', data: data %}
{% assign response = api.api_call_send.response.body | to_hash %}

{% if response.first.author != blank  %}
  {% assign authors = response | map: "author" %}
  {% assign logins = "" | split: "," %}
  {% capture "contributors" %}
    [
      {% for author in authors %}
        {% assign login = author.login %}
          {% assign logins = logins | add_to_array: login %}
          {
            "login": "{{ author.login }}",
            "id": "{{ author.id }}",
            "avatar_url": "{{ author.avatar_url }}",
            "url": "{{ author.url }}"
          }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  {% endcapture %}

  {% assign last_edit = response.first.commit.author.date %}
  {% assign contributors = contributors | to_hash %}

  {% log contributors, type: "contributors" %}

  {% query_graph "get_page_contributors", result_name: "pc", slug: href %}
  {% assign page_contributors = pc.customizations.results.last %}

  {% if page_contributors != blank %}
    {% assign current_contributors = page_contributors.contributors | to_hash  %}
    {% for current_contributor in current_contributors %}
      {% log current_contributor, type: 'current-contributor' %}
      {% assign contributors = contributors | add_to_array: current_contributor %}
    {% endfor %}
  {% endif %}

  {% assign contributors = contributors | uniq | json %}
  {% log contributors, type: "contributors2" %}

  {% if page_contributors.id == blank %}
    {% execute_query "create_page_contributors", slug: href, contributors: contributors, last_edit: last_edit %}
  {% else %}
    {% execute_query "update_page_contributors", id: page_contributors.id, slug: href, contributors: contributors, last_edit: last_edit %}
  {% endif %}
  {{ g }}
{% else %}
  Missing contributors
{% endif %}

{% log "end of script \n" %}
